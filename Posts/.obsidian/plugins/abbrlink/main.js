/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var b=Object.create;var g=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var v=(i,n,t)=>n in i?g(i,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[n]=t;var x=(i,n)=>{for(var t in n)g(i,t,{get:n[t],enumerable:!0})},d=(i,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of m(n))!y.call(i,s)&&s!==t&&g(i,s,{get:()=>n[s],enumerable:!(e=k(n,s))||e.enumerable});return i};var f=(i,n,t)=>(t=i!=null?b(w(i)):{},d(n||!i||!i.__esModule?g(t,"default",{value:i,enumerable:!0}):t,i)),E=i=>d(g({},"__esModule",{value:!0}),i);var c=(i,n,t)=>(v(i,typeof n!="symbol"?n+"":n,t),t);var A={};x(A,{default:()=>l});module.exports=E(A);var a=require("obsidian"),h=f(require("crypto"));var S={hashLength:8,skipExisting:!0,autoGenerate:!1,useRandomMode:!1,checkCollision:!0},l=class extends a.Plugin{constructor(){super(...arguments);c(this,"settings")}generateRandomHash(){let e=h.generateKeyPairSync("ed25519").publicKey.export({type:"spki",format:"der"});return h.createHash("sha256").update(e).digest("hex").substring(0,this.settings.hashLength)}generateSha256(t){return this.settings.useRandomMode?this.generateRandomHash():h.createHash("sha256").update(t).digest("hex").substring(0,this.settings.hashLength)}async getExistingAbbrlink(t){let e=t.match(new RegExp(`abbrlink:\\s*([a-fA-F0-9]{${this.settings.hashLength}})`));return e?e[1]:null}async isHashExisting(t,e){let s=this.app.vault.getMarkdownFiles();for(let r of s){if(r.path===e.path)continue;let o=await this.app.vault.read(r);if(await this.getExistingAbbrlink(o)===t)return!0}return!1}async generateUniqueHash(t){let e=this.generateSha256(t.basename);if(this.settings.checkCollision&&await this.isHashExisting(e,t)){console.log(`Hash collision detected for ${t.path}, using random mode`);do e=this.generateRandomHash();while(await this.isHashExisting(e,t))}return e}async processFile(t){try{let e=await this.app.vault.read(t);if(e.includes("abbrlink:")&&this.settings.skipExisting)return;let s=await this.generateUniqueHash(t),r;if(e.startsWith("---")){let[o,...p]=e.split(`---
`);r=`${o.includes("abbrlink:")?o.replace(/abbrlink:.*/,`abbrlink: ${s}`):`${o}abbrlink: ${s}
`}---
${p.join(`---
`)}`}else r=`---
abbrlink: ${s}
---
${e}`;await this.app.vault.modify(t,r)}catch(e){throw console.error(`Error processing file ${t.path}:`,e),e}}async onload(){await this.loadSettings(),this.addRibbonIcon("link","Generate Abbrlinks",async t=>{try{new a.Notice("Processing files...");let e=this.app.vault.getMarkdownFiles();for(let s of e)await this.processFile(s);new a.Notice("Abbrlinks generated successfully!")}catch(e){new a.Notice("Error generating abbrlinks!"),console.error(e)}}),this.addSettingTab(new u(this.app,this)),this.registerEvent(this.app.vault.on("create",async t=>{if(this.settings.autoGenerate&&t instanceof a.TFile&&t.extension==="md"){let e=this.settings.useRandomMode;this.settings.useRandomMode=!0,await this.processFile(t),this.settings.useRandomMode=e}}))}onunload(){}async loadSettings(){this.settings=Object.assign({},S,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},u=class extends a.PluginSettingTab{constructor(t,e){super(t,e);c(this,"plugin");this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Abbrlink"}),t.createEl("h3",{text:"\u57FA\u672C\u8BBE\u7F6E"}),new a.Setting(t).setName("Abbrlink \u957F\u5EA6").setDesc("Abbrlink \u957F\u5EA6 (4-32)").addSlider(e=>e.setLimits(4,32,4).setValue(this.plugin.settings.hashLength).setDynamicTooltip().onChange(async s=>{this.plugin.settings.hashLength=s,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\u81EA\u52A8\u5316\u9009\u9879"}),new a.Setting(t).setName("\u8DF3\u8FC7\u5DF2\u6709\u94FE\u63A5").setDesc("\u5982\u679C\u6587\u4EF6\u5DF2\u7ECF\u5305\u542B\u7F29\u7565\u94FE\u63A5\uFF0C\u5219\u8DF3\u8FC7\u5904\u7406").addToggle(e=>e.setValue(this.plugin.settings.skipExisting).onChange(async s=>{this.plugin.settings.skipExisting=s,await this.plugin.saveSettings()})),new a.Setting(t).setName("\u81EA\u52A8\u751F\u6210").setDesc("\u4E3A\u65B0\u521B\u5EFA\u7684 Markdown \u6587\u4EF6\u81EA\u52A8\u751F\u6210\u7F29\u7565\u94FE\u63A5").addToggle(e=>e.setValue(this.plugin.settings.autoGenerate).onChange(async s=>{this.plugin.settings.autoGenerate=s,await this.plugin.saveSettings()})),t.createEl("h3",{text:"\u9AD8\u7EA7\u9009\u9879"}),new a.Setting(t).setName("\u968F\u673A\u6A21\u5F0F").setDesc("\u4F7F\u7528\u968F\u673A\u751F\u6210\u7684 SHA256 \u54C8\u5E0C\u503C\u4F5C\u4E3A\u7F29\u7565\u94FE\u63A5\uFF0C\u800C\u4E0D\u662F\u57FA\u4E8E\u6587\u4EF6\u540D\u751F\u6210").addToggle(e=>e.setValue(this.plugin.settings.useRandomMode).onChange(async s=>{this.plugin.settings.useRandomMode=s,await this.plugin.saveSettings()})),new a.Setting(t).setName("\u68C0\u67E5\u54C8\u5E0C\u51B2\u7A81").setDesc("\u5F53\u68C0\u6D4B\u5230\u54C8\u5E0C\u503C\u51B2\u7A81\u65F6\uFF0C\u81EA\u52A8\u5207\u6362\u5230\u968F\u673A\u6A21\u5F0F\u91CD\u65B0\u751F\u6210").addToggle(e=>e.setValue(this.plugin.settings.checkCollision).onChange(async s=>{this.plugin.settings.checkCollision=s,await this.plugin.saveSettings()}))}};
