/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var m=Object.create;var h=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var v=(a,i)=>{for(var e in i)h(a,e,{get:i[e],enumerable:!0})},u=(a,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of k(i))!y.call(a,s)&&s!==e&&h(a,s,{get:()=>i[s],enumerable:!(t=b(i,s))||t.enumerable});return a};var E=(a,i,e)=>(e=a!=null?m(w(a)):{},u(i||!a||!a.__esModule?h(e,"default",{value:a,enumerable:!0}):e,a)),x=a=>u(h({},"__esModule",{value:!0}),a);var S={};v(S,{default:()=>g});module.exports=x(S);var n=require("obsidian"),l=E(require("crypto")),f={hashLength:8,skipExisting:!0,autoGenerate:!1,useRandomMode:!1,checkCollision:!0},g=class extends n.Plugin{generateRandomHash(){let t=l.generateKeyPairSync("ed25519").publicKey.export({type:"spki",format:"der"});return l.createHash("sha256").update(t).digest("hex").substring(0,this.settings.hashLength)}generateSha256(e){return this.settings.useRandomMode?this.generateRandomHash():l.createHash("sha256").update(e).digest("hex").substring(0,this.settings.hashLength)}async getExistingAbbrlink(e){let t=e.match(new RegExp(`abbrlink:\\s*([a-fA-F0-9]{${this.settings.hashLength}})`));return t?t[1]:null}async isHashExisting(e,t){let s=this.app.vault.getMarkdownFiles();for(let o of s){if(o.path===t.path)continue;let r=await this.app.vault.read(o);if(await this.getExistingAbbrlink(r)===e)return!0}return!1}async generateUniqueHash(e){let t=this.generateSha256(e.basename);if(this.settings.checkCollision&&await this.isHashExisting(t,e)){console.log(`Hash collision detected for ${e.path}, using random mode`);do t=this.generateRandomHash();while(await this.isHashExisting(t,e))}return t}async processFile(e){try{let t=await this.app.vault.read(e);if(t.includes("abbrlink:")&&this.settings.skipExisting)return;let s=await this.generateUniqueHash(e),o;if(t.startsWith("---")){let[r,...p]=t.split(`---
`);o=`${r.includes("abbrlink:")?r.replace(/abbrlink:.*/,`abbrlink: ${s}`):`${r}abbrlink: ${s}
`}---
${p.join(`---
`)}`}else o=`---
abbrlink: ${s}
---
${t}`;await this.app.vault.modify(e,o)}catch(t){throw console.error(`Error processing file ${e.path}:`,t),t}}async onload(){await this.loadSettings(),this.addRibbonIcon("link","Generate Abbrlinks",async t=>{try{new n.Notice("Processing files...");let s=this.app.vault.getMarkdownFiles();for(let o of s)await this.processFile(o);new n.Notice("Abbrlinks generated successfully!")}catch(s){new n.Notice("Error generating abbrlinks!"),console.error(s)}}),this.addStatusBarItem().setText("Status Bar Text"),this.addCommand({id:"open-sample-modal-simple",name:"Open sample modal (simple)",callback:()=>{new c(this.app).open()}}),this.addCommand({id:"sample-editor-command",name:"Sample editor command",editorCallback:(t,s)=>{console.log(t.getSelection()),t.replaceSelection("Sample Editor Command")}}),this.addCommand({id:"open-sample-modal-complex",name:"Open sample modal (complex)",checkCallback:t=>{if(this.app.workspace.getActiveViewOfType(n.MarkdownView))return t||new c(this.app).open(),!0}}),this.addSettingTab(new d(this.app,this)),this.registerDomEvent(document,"click",t=>{console.log("click",t)}),this.registerInterval(window.setInterval(()=>console.log("setInterval"),5*60*1e3)),this.registerEvent(this.app.vault.on("create",async t=>{if(this.settings.autoGenerate&&t instanceof n.TFile&&t.extension==="md"){let s=this.settings.useRandomMode;this.settings.useRandomMode=!0,await this.processFile(t),this.settings.useRandomMode=s}}))}onunload(){}async loadSettings(){this.settings=Object.assign({},f,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},c=class extends n.Modal{constructor(i){super(i)}onOpen(){let{contentEl:i}=this;i.setText("Woah!")}onClose(){let{contentEl:i}=this;i.empty()}},d=class extends n.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Abbrlink"}),e.createEl("h3",{text:"\u57FA\u672C\u8BBE\u7F6E"}),new n.Setting(e).setName("Abbrlink \u957F\u5EA6").setDesc("Abbrlink \u957F\u5EA6 (4-32)").addSlider(t=>t.setLimits(4,32,4).setValue(this.plugin.settings.hashLength).setDynamicTooltip().onChange(async s=>{this.plugin.settings.hashLength=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u81EA\u52A8\u5316\u9009\u9879"}),new n.Setting(e).setName("\u8DF3\u8FC7\u5DF2\u6709\u94FE\u63A5").setDesc("\u5982\u679C\u6587\u4EF6\u5DF2\u7ECF\u5305\u542B\u7F29\u7565\u94FE\u63A5\uFF0C\u5219\u8DF3\u8FC7\u5904\u7406").addToggle(t=>t.setValue(this.plugin.settings.skipExisting).onChange(async s=>{this.plugin.settings.skipExisting=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("\u81EA\u52A8\u751F\u6210").setDesc("\u4E3A\u65B0\u521B\u5EFA\u7684 Markdown \u6587\u4EF6\u81EA\u52A8\u751F\u6210\u7F29\u7565\u94FE\u63A5").addToggle(t=>t.setValue(this.plugin.settings.autoGenerate).onChange(async s=>{this.plugin.settings.autoGenerate=s,await this.plugin.saveSettings()})),e.createEl("h3",{text:"\u9AD8\u7EA7\u9009\u9879"}),new n.Setting(e).setName("\u968F\u673A\u6A21\u5F0F").setDesc("\u4F7F\u7528\u968F\u673A\u751F\u6210\u7684 SHA256 \u54C8\u5E0C\u503C\u4F5C\u4E3A\u7F29\u7565\u94FE\u63A5\uFF0C\u800C\u4E0D\u662F\u57FA\u4E8E\u6587\u4EF6\u540D\u751F\u6210").addToggle(t=>t.setValue(this.plugin.settings.useRandomMode).onChange(async s=>{this.plugin.settings.useRandomMode=s,await this.plugin.saveSettings()})),new n.Setting(e).setName("\u68C0\u67E5\u54C8\u5E0C\u51B2\u7A81").setDesc("\u5F53\u68C0\u6D4B\u5230\u54C8\u5E0C\u503C\u51B2\u7A81\u65F6\uFF0C\u81EA\u52A8\u5207\u6362\u5230\u968F\u673A\u6A21\u5F0F\u91CD\u65B0\u751F\u6210").addToggle(t=>t.setValue(this.plugin.settings.checkCollision).onChange(async s=>{this.plugin.settings.checkCollision=s,await this.plugin.saveSettings()}))}};
